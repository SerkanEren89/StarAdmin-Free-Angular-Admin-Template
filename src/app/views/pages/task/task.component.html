<div class="row title-container">
  <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 parent">
    <span class="input-group-text text-primary title">
    <img class="mdi mdi-cube icon-lg category-icon side-icon" src="assets/svg/task.svg">
    Task
    </span>
  </div>
  <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 title-button">
    <button type="button" class="btn btn-primary" (click)="filterTasks(filter)"><i class="mdi mdi-filter"></i>
      Filter Tasks
    </button>
  </div>
</div>

<div class="row" *ngIf="taskStats != null">
  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body pointer">
        <div class="clearfix">
          <div class="float-left">
            <i class="fa fa-check category-icon text-success"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right">Closed</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 text-success">{{taskStats.finished}}</h3>
              <p class="text-right mb-0">Task</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body pointer">
        <div class="clearfix">
          <div class="float-left">
            <i class="fa fa-clock category-icon text-warning"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right">Pending</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 text-warning">{{taskStats.pending}}</h3>
              <p class="text-right mb-0">Task</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body pointer">
        <div class="clearfix">
          <div class="float-left">
            <i class="fa fa-hourglass-end category-icon text-danger"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right">Reminded</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 text-danger">{{taskStats.reminder}}</h3>
              <p class="text-right mb-0">Task</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 grid-margin stretch-card">
    <div class="card card-statistics">
      <div class="card-body pointer">
        <div class="clearfix">
          <div class="float-left">
            <i class="fa fa-percentage category-icon"></i>
          </div>
          <div class="float-right">
            <p class="mb-0 text-right">Progress Rate</p>
            <div class="fluid-container">
              <h3 class="font-weight-medium text-right mb-0 text-success" *ngIf="taskStats.successRate > 70">{{taskStats.successRate}}</h3>
              <h3 class="font-weight-medium text-right mb-0 text-warning" *ngIf="taskStats.successRate >= 50 && taskStats.successRate <= 70">{{taskStats.successRate}}</h3>
              <h3 class="font-weight-medium text-right mb-0 text-danger" *ngIf="taskStats.successRate < 50">{{taskStats.successRate}}</h3>
              <p class="text-right mb-0">{{taskStats.finished}} / {{taskStats.total}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row" *ngIf="tasks.length > 0">
  <div class="col-lg-12 grid-margin">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Tasks</h4>
        <div class="table-responsive">
          <table class="table table-bordered" #taskTable>
            <thead>
            <tr>
              <th>
                Assigned
              </th>
              <th style="width: 15%">
                Status
              </th>
              <th style="width: 30%">
                Review
              </th>
              <th style="width: 15%">
                Note
              </th>
              <th style="width: 15%">
                Result Note
              </th>
              <th style="width: 15%">
                Result Status
              </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let task of tasks">
              <td class="comment"
                  (click)="openDetailPopup(task, contentTaskDetail)">
                {{task.employee.firstName}} {{task.employee.lastName}}
              </td>
              <td class="comment table-center"
                  (click)="openDetailPopup(task, contentTaskDetail)">
                <i class="fa fa-clock table-icon text-warning" *ngIf="task.taskStatus == 'PENDING'"></i>
                <i class="fa fa-check table-icon text-success" *ngIf="task.taskStatus == 'CLOSED'"></i>
                <i class="fa fa-hourglass-end table-icon text-danger" *ngIf="task.taskStatus == 'REMINDER'"></i>
                <span *ngIf="task.days > 0" class="interval-text">{{task.days}} days ago</span>
              </td>
              <td class="text comment"
                  (click)="openDetailPopup(task, contentTaskDetail)"
                  *ngIf="task.comment.content != null && task.comment.content.length <= 100">
                {{task.comment.content}}
              </td>
              <td class="text comment"
                  (click)="openDetailPopup(task, contentTaskDetail)"
                  *ngIf="task.comment.content != null && task.comment.content.length > 100">
                {{task.comment.content | slice:0:100}}...
              </td>
              <td class="comment"
                  (click)="openDetailPopup(task, contentTaskDetail)">
                {{task.description}}
              </td>
              <td class="comment"
                  (click)="openDetailPopup(task, contentTaskDetail)">
                {{task.resultNote}}
              </td>
              <td class="comment"
                  (click)="openDetailPopup(task, contentTaskDetail)">
                <span class="text-success" *ngIf="task.resultStatus == 'SUCCESSFULLYCOMPLETED'"> Successfully completed</span>
                <span class="text-danger" *ngIf="task.resultStatus == 'CANNOTBECOMPLETED'"> Can not be completed</span>
                <span class="text-warning" *ngIf="task.resultStatus == 'WILLBECONSIDEREDLATER'"> Will be considered later</span>
              </td>
            </tr>
            </tbody>
          </table>
          <ngb-pagination [collectionSize]="totalElements" [pageSize]="pageSize" [page]="page"
                          (pageChange)="loadTasks($event)"
                          [maxSize]="3" [rotate]="true" [ellipses]="false" [boundaryLinks]="true"
                          aria-label="Default pagination"
                          class="d-flex pagination justify-content-end pagination-success"></ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row" *ngIf="tasks.length == 0">
  <div class="col-lg-12 grid-margin">
    <div class="card">
      <div class="card-body">
        <div class="table-responsive empty-text">
          <i class="fa fa-exclamation-triangle icon-md text-danger"></i> You didn't create any task yet
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #contentTaskDetail let-modalReview>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-comment-detail">Assigned Task</h4>
    <button type="button" class="close" aria-label="Close" (click)="modalReview.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="summary-container">
      <div class="summary">
        <div class="assignee-container">
          <div class="detail-container status">
            <p class="written">Created at: {{selectedTask.creationDate  | date:'dd/MM/yyyy'}}</p>
            <p class="author">Assigned
              to: {{selectedTask.employee.firstName }} {{selectedTask.employee.lastName }}</p>
          </div>
          <div class="row">
            <div class="col-lg-6 col-md-12 col-sm-12">
              <p class="written finished" *ngIf="selectedTask.endDate != null">
                Closed: {{selectedTask.creationDate  | date:'dd/MM/yyyy'}}
                <i class="fa fa-check-circle"></i>
              </p>
            </div>
            <div class="col-lg-6 col-md-12 col-sm-12">
              <p class="written author task-result">
                <span class="text-success" *ngIf="selectedTask.resultStatus == 'SUCCESSFULLYCOMPLETED'"> Successfully completed</span>
                <span class="text-danger" *ngIf="selectedTask.resultStatus == 'CANNOTBECOMPLETED'"> Can not be completed</span>
                <span class="text-warning" *ngIf="selectedTask.resultStatus == 'WILLBECONSIDEREDLATER'"> Will be considered later</span>
              </p>
            </div>
          </div>
        </div>
        <div class="detail-container">
          <app-channel-icon [source]="selectedTask.comment.source.toLowerCase()"></app-channel-icon>
          <p class="written">Written By: {{selectedTask.comment.author}}</p>
          <p class="written">{{selectedTask.comment.commentDate  | date:'dd/MM/yyyy'}}</p>
        </div>
        <p class="content-comment">{{selectedTask.comment.content}}</p>
        <div class="content-container" *ngIf="selectedTask.comment.translatedText != null">
          <p class="text-danger content-title">Translated Review: </p>
          <p class="content-answer">{{selectedTask.comment.translatedText}}</p>
        </div>
        <div class="content-container" *ngIf="selectedTask.description != null">
          <p class="text-danger content-title">Note from {{selectedTask.creator.firstName}} {{selectedTask.creator.lastName}}:  </p>
          <p class="content-answer">{{selectedTask.description}}</p>
        </div>
        <div class="content-container" *ngIf="selectedTask.resultNote != null">
          <p class="text-danger content-title">Closing Note: </p>
          <p class="content-answer">{{selectedTask.resultNote}}</p>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-primary" *ngIf="selectedTask.taskStatus == 'PENDING' || selectedTask.taskStatus == 'REMINDER'" (click)="remindTask()">Remind Task</button>
  </div>
</ng-template>

<ng-template #filter let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Filter Status</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form class="assignee-form">
      <div class="form-group">
        <label>Employee</label>
        <div class="input-group">
          <input id="assignee" type="text" class="form-control" name="assignee"
                 [resultFormatter]="resultFormatter"
                 [inputFormatter]="inputFormatter"
                 [(ngModel)]="taskFilter.employee" [ngbTypeahead]="search"
                 (focus)="focus$.next($event.target.value)"
          />
        </div>
      </div>
      <div class="form-group">
        <label>Status</label>
        <div class="input-group">
          <label class="form-check-label" *ngFor="let status of statuses; let i = index;">
            <input type="checkbox" value="{{status}}" class="status"
                   (change)="changeFilteredStatus(i)"
                   [checked]="status.checked">{{status.name}}
          </label>
        </div>
      </div>
      <div class="form-group">
        <label>Creation Date</label>
        <div class="input-group ">
          <input type="text" matInput
                 ngxDaterangepickerMd
                 autocomplete="off"
                 opens="center"
                 autoApply="true"
                 [locale]="{applyLabel: 'ok', format: 'DD-MM-YYYY'}"
                 startKey="start"
                 endKey="end"
                 placeholder="Select date to filter"
                 class="date-filter"
                 [(ngModel)]="selected"
                 name="daterange"/>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-danger" (click)="clearFilter()">Clear</button>
    <button type="button" class="btn btn-outline-dark" (click)="getFilteredTasks()">Filter</button>
  </div>
</ng-template>
